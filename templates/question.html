{% extends "base.html" %}
{% block content %}
<div id="spinner" class="spinner"></div>
        <main >
            <!-- ğŸ”¹ ã“ã“ã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ  -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <p class="flash {{ category }}">{{ message }}</p>
                    {% endfor %}
                </div>
            {% endif %}
            {% endwith %}

            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="navigation-buttons"id="question-start">
                {% if prev_index is not none %}
                <a href="{{ url_for('view_question', id=prev_id) }}" 
                    class="prev-button"
                    onclick="handleNavigation(event, '{{ prev_id }}', '{{ last_question_id }}', 'ğŸš€ å‰ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€å¾Œã®å•é¡Œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚')">
                    <i class="fa-solid fa-circle-arrow-left"></i> <span class="btn-text">å‰ã®å•é¡Œ</span>
                    <span class="loading-spinner hidden">ğŸ”„</span>
                </a>
             
                {% else %}
                    <span class="disabled-button">å‰ã®å•é¡Œ</span>
                {% endif %}

                <div  id ="question_number"><p>{{ question_number }}/{{ total_questions }}</p></div>
                      
                {% if next_index is not none %}
                <a href="{{ url_for('view_question', id=next_id) }}" 
                    class="next-button" id ="nextButton"
                    onclick="handleNavigation(event, '{{ next_id }}', '{{ first_question_id }}', 'ğŸš€ æ¬¡ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®å•é¡Œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚')">
                    <i class="fa-solid fa-circle-arrow-right"></i> <span class="btn-text">æ¬¡ã®å•é¡Œ</span>
                    <span class="loading-spinner hidden">ğŸ”„</span>
                </a>
                {% else %}
                    <span class="disabled-button">æ¬¡ã®å•é¡Œ</span>
                {% endif %}

            </div>


                <!-- âœ… 1ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã ã‘ã‚’ä½œã‚‹ï¼ -->
                <p id="message-box" class="hidden-message"></p>


            <!-- å•é¡Œè¡¨ç¤º -->
            {% if question %}
                <div class="question-container" >
                    <div id = "question_info">
                        <p class ="question_info">ID:{{ question.id}}</p>
                        <p class ="question_info">ã‚«ãƒ†ã‚´ãƒª:{{ question.category.name}}</p>
                        
                    </div>
                    <div id ="question{{ question['id'] }}" class="question-box" >
                        <p class="contents_text">å•é¡Œ: {{ question.question | safe }}</p>
                    </div>


        
                    <!-- ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚¨ãƒªã‚¢ -->
                    <strong>ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦è©¦ã—ã¦ã¿ã‚ˆã†:</strong>
                    <div id = "code_input_area">
                        <textarea id="code-editor"></textarea>
                        <button id = "code_enter_button"onclick="runPythonCode()">å®Ÿè¡Œ</button>
                    </div> 
                    
                    <pre id="output"></pre> <!-- å‡ºåŠ›ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
            
                        <!-- è§£ç­”ãƒœã‚¿ãƒ³ -->
                    <button id="answer-button" onclick="showAnswerAndDescription('answer{{ question.id }}', 'description{{ question.id }}')">
                        è§£ç­”ã‚’è¦‹ã‚‹
                    </button>
                                
                    <!-- è§£ç­” -->
                    <div id="answer{{ question['id'] }}" class="answer-box" style="display: none;">
                        <p class="contents_text">è§£ç­”: {{ question.answer | safe }}</p>
                    </div>
                    
                    <div id="description{{ question['id'] }}" class="description-box" style="display: none;">
                        <p class="contents_text">è§£èª¬: {{ question.description | safe }}</p>
                    </div>
                </div>
            {% else %}
                <p>è©²å½“ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
                

        

            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="navigation-buttons"id="question-start">
                {% if prev_index is not none %}
                <a href="{{ url_for('view_question', id=prev_id) }}" 
                    class="prev-button" id="prevButton"
                    onclick="handleNavigation(event, '{{ prev_id }}', '{{ last_question_id }}', 'ğŸš€ å‰ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€å¾Œã®å•é¡Œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚')">
                    <i class="fa-solid fa-circle-arrow-left"></i> <span class="btn-text">å‰ã®å•é¡Œ</span>

                </a>
             
                {% else %}
                    <span class="disabled-button">å‰ã®å•é¡Œ</span>
                {% endif %}

                <div  id ="question_number"><p>{{ question_number }}/{{ total_questions }}</p></div>
                      
                {% if next_index is not none %}
                <a href="{{ url_for('view_question', id=next_id) }}" 
                    class="next-button"
                    onclick="handleNavigation(event, '{{ next_id }}', '{{ first_question_id }}', 'ğŸš€ æ¬¡ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®å•é¡Œã‚’è¡¨ç¤ºã—ã¾ã™ã€‚')">
                    <i class="fa-solid fa-circle-arrow-right"></i> <span class="btn-text">æ¬¡ã®å•é¡Œ</span>
                </a>
                {% else %}
                    <span class="disabled-button">æ¬¡ã®å•é¡Œ</span>
                {% endif %}

            </div>


        </main>

                
        
    </div>





<script>
function showAnswerAndDescription(answerId, descriptionId) {
    // è§£ç­”ã‚’è¡¨ç¤º
    document.getElementById(answerId).style.display = "block";
    // è§£èª¬ã‚’è¡¨ç¤º
    document.getElementById(descriptionId).style.display = "block";
}

<!-- ã‚³ãƒ¼ãƒ‰å…¥åŠ›ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->


<!-- CodeMirror ã‚’é©ç”¨ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    // CodeMirror ã‚’é©ç”¨
    var editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
        mode: "python",
        theme: "dracula",
        lineNumbers: true,
        indentUnit: 4,
        tabSize: 4,
        smartIndent: true,
        matchBrackets: true
    });

    function runPythonCode() {
        var code = editor.getValue(); // CodeMirror ã®å†…å®¹ã‚’å–å¾—
        fetch('/run', {  // Flask ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ "/run" ã«ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ code: code })  // JSON ã§ã‚³ãƒ¼ãƒ‰ã‚’é€ã‚‹
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("output").textContent = data.result; // çµæœã‚’è¡¨ç¤º
        })
        .catch(error => {
            console.error("ã‚¨ãƒ©ãƒ¼:", error);
            document.getElementById("output").textContent = "å®Ÿè¡Œã‚¨ãƒ©ãƒ¼";
        });
    }

    function handleCategorySubmit() {
        const form = document.querySelector("form");
        form.submit();
        return false; // âœ… äºŒé‡é€ä¿¡ã‚’é˜²ãï¼
    }
    


    // âœ… URL ã‹ã‚‰ `q=` ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
    window.onload = function() {
        let url = new URL(window.location);
        if (url.searchParams.has("q") && url.searchParams.get("q") === "") {
            url.searchParams.delete("q");
            window.history.replaceState(null, "", url.toString());
        }
    };

  

    document.addEventListener("DOMContentLoaded", function() {
    const targetElement = document.getElementById("question-start");

    if (targetElement) {
        let offset = window.innerWidth <= 768 ? 0 : 500;  // âœ… ã‚¹ãƒãƒ›ã¨PCã§ã‚ªãƒ•ã‚»ãƒƒãƒˆå¤‰æ›´
        let targetPosition = targetElement.getBoundingClientRect().top + window.scrollY - offset;

        console.log(`ğŸ“ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®: ${targetPosition} (ã‚ªãƒ•ã‚»ãƒƒãƒˆ: ${offset})`);

        window.scrollTo({
            top: targetPosition,
            behavior: "smooth"
        });
    }
});


function handleNavigation(event, questionId) {
    event.preventDefault();  // âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒªãƒ³ã‚¯å‹•ä½œã‚’é˜²ã
    document.getElementById("spinner").style.display = "block";  // âœ… ã‚¹ãƒ”ãƒŠãƒ¼ã‚’è¡¨ç¤º

    setTimeout(() => {
        window.location.href = `/question/${questionId}`;  // âœ… æ¬¡ã® or å‰ã®å•é¡Œã¸é·ç§»
    }, 300);
}




</script>


{% endblock %}
