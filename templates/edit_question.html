<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã€‘Python å•é¡Œé›†</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">



</head>
<body>
    <header>
        <h1>ã€ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã€‘å•é¡Œã‚’ç·¨é›†</h1>
        <h3>pythonå•é¡Œã€€æ•°ã‚’ã“ãªã›ï¼</h3>

    </header>
    
    <div class="container">
        <aside>
            <p> å•é¡Œã‚’ç™»éŒ²ã™ã‚‹</p>
            <button id="registerButton" type="submit">ç™»éŒ²</button>
            <p> å•é¡Œã‚’å‰Šé™¤ã™ã‚‹</p>
            <button id="deleteButton">å‰Šé™¤</button>


        </aside>

        <main>
            <form method="POST" action="{{ url_for('edit_question', id=question.id) }}">
                <!-- å•é¡Œç·¨é›† -->
                <div class="question-box">
                    <textarea id="edit_question" name="edit_question">{{ question.question if question.question else '' }}</textarea>
                </div>
                <!-- æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã®ç·¨é›†ç·¨é›† -->
                <div class="expected-output">
                    <label for="edit_expected_output" class="boxtitle">æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:</label>
                    <textarea id="edit_expected_output" name="edit_expected_output" rows="2">{{ question.expected_output if question.expected_output else '' }}</textarea>
                </div>
                <!-- è§£ç­”ã®ç·¨é›† -->
                <div class="answer-box">
                    <textarea id="edit_answer" name="edit_answer">{{ question.answer if question.answer else '' }}</textarea>
                </div>
                <!-- è§£èª¬ç·¨é›† -->
                <div class="description-box">
                    <label for="edit_description">è§£èª¬:</label>
                    <textarea id="edit_description" name="edit_description">{{ question.description if question.description else '' }}</textarea>
                </div>
                <button type="button" onclick="saveQuestion({{ question.id }})" class="save-button">ä¿å­˜</button>

           
            <a href="/admin/manage" class="link-button">ç®¡ç†ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹</a>

                <label for="category_id">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ:</label>
                <select name="category_id" id ="edit_category_menu">
                    <option value="{{ question.category.id }}">{{ question.category.name }}</option> <!-- âœ… ç¾åœ¨ã®ã‚«ãƒ†ã‚´ãƒªã‚’è¡¨ç¤º -->
                        {% for category in categories %}
                            {% if category.id != question.category_id %}  <!-- âœ… æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯é™¤å¤– -->
                                <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endif %} 
                        {% endfor %}                   .
                </select>

                <label for="difficulty_level_id">é›£æ˜“åº¦ã‚’é¸æŠ:</label>
                <select name="difficulty_level_id" id = "edit_difficulty_level_menu">
                    <option value="{{question.difficulty.id }}">{{ question.difficulty.level}}</option>
                        {% for level in difficulty_levels %}
                            {% if level.id != question.difficulty_id %} 
                            <option value="{{ level.id}}">{{ level.level }}</option>
                            {% endif %} 
                        {% endfor %}
                </select>
            </form>                 
        </main>
        
    </div>

    <footer>
        <p>&copy; 2025 pythonå•é¡Œé›†</p>
        <a href="#top">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>

    </footer>


    <script>
        function saveQuestion(id) {
            const question = document.getElementById('edit_question').value;
            const answer = document.getElementById('edit_answer').value;
            const description = document.getElementById('edit_description').value;
            const category_id = document.querySelector('[name="category_id"]').value;
            const difficulty_level_id = document.querySelector('[name="difficulty_level_id"]').value;
        
            fetch(`/admin/edit/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // âœ… JSON ã§é€ä¿¡ã™ã‚‹ï¼
                },
                body: JSON.stringify({
                    question: question,
                    answer: answer,
                    description: description,
                    category_id: category_id,
                    difficulty_level_id: difficulty_level_id,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert("âœ… " + data.message);  // âœ… æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    window.location.href = "/admin/manage";  // âœ… å¤‰æ•°åã‚’ `id` ã«ä¿®æ­£ï¼
                } else {
                    alert("âš ï¸ ã‚¨ãƒ©ãƒ¼: " + data.error);  // âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                }     
            })
            .catch(error => {
                console.error('ğŸš¨ ã‚¨ãƒ©ãƒ¼:', error);
            });
        }
        </script>
        


    
</body>



