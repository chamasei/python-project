<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python å•é¡Œé›†</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
    <link href="../static/style.css" rel = "stylesheet" /> 
    <!-- CodeMirror ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <!-- CodeMirror ã®ãƒ†ãƒ¼ãƒï¼ˆVSCode é¢¨ï¼‰ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">

    <!-- CodeMirror ã® JavaScript æœ¬ä½“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <!-- CodeMirror ã® Python ç”¨ãƒ¢ãƒ¼ãƒ‰ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
    <!-- æ‹¬å¼§ã®è‡ªå‹•è£œå®Œ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <header>
        <h1>
            <span class="python">Python</span>ã§éŠã¼ã†
        </h1>
        
        <h3>æ‰‹ã‚’å‹•ã‹ã—ã¦å­¦ã¶ Pythonå•é¡Œé›†</h3>

    </header>



    
    <div class="container">
        <aside>
            <h3 id = "search-title">æ¤œç´¢</h3>
            <form method="GET" class = "search" id = "search-form" action="/">
                <label for="q">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›:</label>
                <input type="text" class="input-box" name="q" id ="q" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" value="{{ query if query else '' }}" >

                <label for="category_id">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ:</label>
                <select name="category_id" class="input-box" id="category_id">
                    <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}"
                        {% if category_id is not none and category_id|string == category.id|string %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
                

                <label for="difficulty_level_id">é›£æ˜“åº¦ã‚’é¸æŠ:</label>
                <select name="difficulty_level_id" class="input-box" id="difficulty_level_id">
                    <option value="">ã™ã¹ã¦ã®é›£æ˜“åº¦</option>
                    {% if  difficulty_levels %}
                        {% for  difficulty_level in  difficulty_levels %}
                            <option value="{{ difficulty_level.id }}" 
                            {% if difficulty_level_id is not none and difficulty_level_id|string == difficulty_level.id|string %}selected{% endif %}>
                                {{  difficulty_level.level }}
                            </option>                    
                        {% endfor %}
                    {% else %}
                        <option value="">ã‚«ãƒ†ã‚´ãƒªãŒã‚ã‚Šã¾ã›ã‚“</option>
                    {% endif %}
                </select>

                <!-- çµè¾¼ã¿æ¤œç´¢ãƒœã‚¿ãƒ³ -->
                <button type="submit">çµè¾¼ã¿æ¤œç´¢</button>
                <button type="reset" name = "clear-search" onclick="resetSearch()" class="clear-button">ã‚¯ãƒªã‚¢</button>
            </form>

            
        </aside>
        

        <main >
            <!-- ğŸ”¹ ã“ã“ã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ  -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <p class="flash {{ category }}">{{ message }}</p>
                    {% endfor %}
                </div>
            {% endif %}
            {% endwith %}

            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="navigation-buttons"id="question-start">
                {% if prev_index is not none %}
                <a href="{{ url_for('view_questions', id=prev_id, category_id=category_id, difficulty_level_id=difficulty_level_id, q=query) }}" class="prev-button"><i class="fa-solid fa-circle-arrow-left"></i></a>
                {% else %}
                    <span class="disabled-button">å‰ã®å•é¡Œ</span>
                {% endif %}

                <h2><p>{{ question_number }}/{{ total_questions }}</p></h2>
                      
                {% if next_index is not none %}
                <a href="{{ url_for('view_questions', id=next_id, category_id=category_id, difficulty_level_id=difficulty_level_id,q=query) }}" class="next-button"><i class="fa-solid fa-circle-arrow-right"></i></a>

                {% else %}
                    <span class="disabled-button">æ¬¡ã®å•é¡Œ</span>
                {% endif %}
            </div>

            

            <!-- å•é¡Œè¡¨ç¤º -->
            {% if question %}
                <div class="question-container" >
                    <div id = "question_info">
                        <p class ="question_info">ID:{{ question.id}}</p>
                        <p class ="question_info">ã‚«ãƒ†ã‚´ãƒª:{{ question.category_name}}</p>
                    </div>
                    <div class="question-box">
                        <p class="description-text">å•é¡Œ: {{ question.question | safe }}</p>
                    </div>

                    
                    <!-- æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ãŒã‚ã‚‹å ´åˆ -->
                    {% if questions[0].expected_output %}
                    <div class="expected-output">
                        <strong>æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:</strong>
                        <pre>{{ questions[0].expected_output | default('å‡ºåŠ›ä¾‹ãªã—', true) }}</pre>
                    </div>
                    {% else %}
                        <p>å‡ºåŠ›ä¾‹ãªã—</p>
                    {% endif %}
                


        
                    <!-- ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚¨ãƒªã‚¢ -->
                    <strong>ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦è©¦ã—ã¦ã¿ã‚ˆã†:</strong>
                    <div id = "code_input_area">
                        <textarea id="code-editor"></textarea>
                        <button id = "code_enter_button"onclick="runPythonCode()">å®Ÿè¡Œ</button>
                    </div> 
                    
                    <pre id="output"></pre> <!-- å‡ºåŠ›ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
            
                        <!-- è§£ç­”ãƒœã‚¿ãƒ³ -->
                    <button id="answer-button" onclick="showAnswerAndDescription('answer{{ question.id }}', 'description{{ question.id }}')">
                        è§£ç­”ã‚’è¦‹ã‚‹
                    </button>
                                
                    <!-- è§£ç­” -->
                    <div id="answer{{ question['id'] }}" class="answer-box" style="display: none;">
                        <p class="description-text">è§£ç­”: {{ question.answer | safe }}</p>
                    </div>
                    
                    <div id="description{{ question['id'] }}" class="description-box" style="display: none;">
                        <p class="description-text">è§£èª¬: {{ question.description | safe }}</p>
                    </div>
                </div>
            {% else %}
                <p>è©²å½“ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
                

        
            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="navigation-buttons">
                {% if prev_index is not none %}
                <a href="{{ url_for('view_questions', id=prev_id, category_id=category_id, difficulty_level_id=difficulty_level_id, q=query) }}" class="prev-button"><i class="fa-solid fa-circle-arrow-left"></i></a>
                {% else %}
                    <span class="disabled-button">å‰ã®å•é¡Œ</span>
                {% endif %}

                <h2><p>{{ question_number }}/{{ total_questions }}</p></h2>
                      
                {% if next_index is not none %}
                <a href="{{ url_for('view_questions', id=next_id, category_id=category_id, difficulty_level_id=difficulty_level_id,q=query) }}" class="next-button"><i class="fa-solid fa-circle-arrow-right"></i></a>
                {% else %}
                    <span class="disabled-button">æ¬¡ã®å•é¡Œ</span>
                {% endif %}
            </div>
        </main>

                
        
    </div>

<footer>
    <p>&copy; 2025 pythonå•é¡Œé›†</p>
    <a href="#top">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>

</footer>

</body>

<script>
function showAnswerAndDescription(answerId, descriptionId) {
    // è§£ç­”ã‚’è¡¨ç¤º
    document.getElementById(answerId).style.display = "block";
    // è§£èª¬ã‚’è¡¨ç¤º
    document.getElementById(descriptionId).style.display = "block";
}

<!-- ã‚³ãƒ¼ãƒ‰å…¥åŠ›ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->


<!-- CodeMirror ã‚’é©ç”¨ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    // CodeMirror ã‚’é©ç”¨
    var editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
        mode: "python",
        theme: "dracula",
        lineNumbers: true,
        indentUnit: 4,
        tabSize: 4,
        smartIndent: true,
        matchBrackets: true
    });

    function runPythonCode() {
        var code = editor.getValue(); // CodeMirror ã®å†…å®¹ã‚’å–å¾—
        fetch('/run', {  // Flask ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ "/run" ã«ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ code: code })  // JSON ã§ã‚³ãƒ¼ãƒ‰ã‚’é€ã‚‹
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("output").textContent = data.result; // çµæœã‚’è¡¨ç¤º
        })
        .catch(error => {
            console.error("ã‚¨ãƒ©ãƒ¼:", error);
            document.getElementById("output").textContent = "å®Ÿè¡Œã‚¨ãƒ©ãƒ¼";
        });
    }

    function handleCategorySubmit() {
        const form = document.querySelector("form");
        form.submit();
        return false; // âœ… äºŒé‡é€ä¿¡ã‚’é˜²ãï¼
    }
    


    // âœ… URL ã‹ã‚‰ `q=` ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
    window.onload = function() {
        let url = new URL(window.location);
        if (url.searchParams.has("q") && url.searchParams.get("q") === "") {
            url.searchParams.delete("q");
            window.history.replaceState(null, "", url.toString());
        }
    };

    function resetSearch() {
        let form = document.getElementById("search-form");
        if (form) {
            form.reset();  // âœ… ç¢ºå®Ÿã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            console.log("ãƒ•ã‚©ãƒ¼ãƒ ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸï¼");  // âœ… ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆé–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ç¢ºèªï¼‰
        } else {
            console.error("ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
        }
        window.location.href = "{{ url_for('view_questions') }}";  // âœ… URLã‚’ãƒªãƒ­ãƒ¼ãƒ‰
    }
    

    document.addEventListener("DOMContentLoaded", function() {
    const targetElement = document.getElementById("question-start");

    if (targetElement) {
        let offset = window.innerWidth <= 768 ? 0 : 500;  // âœ… ã‚¹ãƒãƒ›ã¨PCã§ã‚ªãƒ•ã‚»ãƒƒãƒˆå¤‰æ›´
        let targetPosition = targetElement.getBoundingClientRect().top + window.scrollY - offset;

        console.log(`ğŸ“ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®: ${targetPosition} (ã‚ªãƒ•ã‚»ãƒƒãƒˆ: ${offset})`);

        window.scrollTo({
            top: targetPosition,
            behavior: "smooth"
        });
    }
});

</script>



